

  * [ 前言 ](../)
  * 物联网平台操作 
    * [ 前言 ](../物联网平台/)
    * 快速开始 
      * [ introduction ](../物联网平台/quick-start/introduction.html)
      * [ demo ](../物联网平台/quick-start/demo.html)
    * 开发指南 
      * [ assets ](../物联网平台/dev-guide/assets.html)
      * [ commons-api ](../物联网平台/dev-guide/commons-api.html)
      * [ crud ](../物联网平台/dev-guide/crud.html)
      * [ custom-sql-term ](../物联网平台/dev-guide/custom-sql-term.html)
      * [ dashboard ](../物联网平台/dev-guide/dashboard.html)
      * [ device-firmware ](../物联网平台/dev-guide/device-firmware.html)
      * [ mqtt-subs ](../物联网平台/dev-guide/mqtt-subs.html)
      * [ multi-tenant ](../物联网平台/dev-guide/multi-tenant.html)
      * [ websocket-subs ](../物联网平台/dev-guide/websocket-subs.html)
    * 最佳实践 
      * [ auto-register ](../物联网平台/best-practices/auto-register.html)
      * [ coap-connection ](../物联网平台/best-practices/coap-connection.html)
      * [ device-alarm ](../物联网平台/best-practices/device-alarm.html)
      * [ device-connection ](../物联网平台/best-practices/device-connection.html)
      * [ device-gateway-connection ](../物联网平台/best-practices/device-gateway-connection.html)
      * [ http-connection ](../物联网平台/best-practices/http-connection.html)
      * [ jetlinks对接其他云平台教程-HTTP方式 ](../物联网平台/best-practices/jetlinks对接其他云平台教程-HTTP方式.html)
      * [ open-api ](../物联网平台/best-practices/open-api.html)
      * [ sort-link ](../物联网平台/best-practices/sort-link.html)
      * [ start ](../物联网平台/best-practices/start.html)
      * [ tcp-connection ](../物联网平台/best-practices/tcp-connection.html)
      * [ udp-connection ](../物联网平台/best-practices/udp-connection.html)
    * 使用手册 
      * [ DemoDevice ](../物联网平台/basics-guide/DemoDevice.html)
      * [ device-manager ](../物联网平台/basics-guide/device-manager.html)
      * [ protocol-support ](../物联网平台/basics-guide/protocol-support.html)
      * [ quick-start ](../物联网平台/basics-guide/quick-start.html)
      * [ rule-engine ](../物联网平台/basics-guide/rule-engine.html)
      * [ ziduanquanxian ](../物联网平台/basics-guide/ziduanquanxian.html)
  * 萌蜂项目规范 
    * [ 前言 ](../萌蜂项目规范/)
    * 一、开发项 
      * [ 快速开始 ](../萌蜂项目规范/开发项/idea-start.html)
      * [ 环境维护 ](../萌蜂项目规范/开发项/环境维护.html)
      * [ 代码管理 ](../萌蜂项目规范/开发项/代码管理.html)
      * [ 后端开发 ](../萌蜂项目规范/开发项/后端开发.html)
      * [ 前端开发 ](../萌蜂项目规范/开发项/前端开发.html)
      * [ 工程专项 ](../萌蜂项目规范/开发项/工程专项.html)
      * [ 其他规约 ](../萌蜂项目规范/开发项/其他规约.html)
      * [ 流程管理 ](../萌蜂项目规范/开发项/流程管理.html)
    * 二、知识点 
      * [ 安装 Centos7 ](../萌蜂项目规范/知识点/install-centos7.html)
      * [ Centos 创建用户 ](../萌蜂项目规范/知识点/centos-create-user.html)
      * [ Centos 安装桌面环境 ](../萌蜂项目规范/知识点/centos-install-gnome.html)
      * [ Centos 安装KVM ](../萌蜂项目规范/知识点/centos-install-kvm.html)
      * [ Centos 安装VNC ](../萌蜂项目规范/知识点/centos-install-vnc.html)
      * [ Centos 安装Pip ](../萌蜂项目规范/知识点/centos-install-pip.html)
      * [ Docker Compose ](../萌蜂项目规范/知识点/docker-compose.html)
      * [ FFmpeg ](../萌蜂项目规范/知识点/ffmpeg.html)
      * [ Nginx 代理 ](../萌蜂项目规范/知识点/nginx-prefix.html)
      * [ Nginx Rtmp ](../萌蜂项目规范/知识点/nginx-rtmp.html)
      * [ Nohup ](../萌蜂项目规范/知识点/nohup.html)
      * [ NodeJs ](../萌蜂项目规范/知识点/nodejs-upgrade.html)
      * [ Http Code ](../萌蜂项目规范/知识点/http-code.html)
      * [ String.format() ](../萌蜂项目规范/知识点/string-format.html)
  * JAVA开发规范 
    * [ 前言 ](./)
    * 一、编程规约 
      * [ （一）命名风格 ](编程规约/命名风格.html)
      * [ （二）常量定义 ](编程规约/常量定义.html)
      * [ （三）代码格式 ](编程规约/代码格式.html)
      * [ （四）OOP规范 ](编程规约/OOP规范.html)
      * [ （五）集合处理 ](编程规约/集合处理.html)
      * [ （六）并发处理 ](编程规约/并发处理.html)
      * [ （七）控制语句 ](编程规约/控制语句.html)
      * [ （八）注释规约 ](编程规约/注释规约.html)
    * 二、异常日志 
      * [ （一）异常处理 ](异常日志/异常处理.html)
      * [ （二）日志规范 ](异常日志/日志规约.html)
      * [ （三）其他 ](异常日志/其他.html)
    * [ 三、单元测试 ](单元测试.html)
    * [ 四、安全规约 ](安全规约.html)
    * 五、MySQL数据库 
      * [ （一）建表规约 ](MySQL数据库/建表规约.html)
      * [ （二）索引规约 ](MySQL数据库/索引规约.html)
      * [ （三）SQL语句 ](MySQL数据库/SQL语句.html)
      * [ （四）ORM映射 ](MySQL数据库/ORM映射.html)
    * 六、工程结构 
      * [ （一）应用分层 ](工程结构/应用分层.html)
      * [ （二）二方库依赖 ](工程结构/二方库依赖.html)
      * [ （三）服务器 ](工程结构/服务器.html)
    * [ 附：本手册专有名词 ](本手册专有名词.html)
  * MIS系统操作手册 
    * [ MIS系统操作手册 ](../用户操作手册/用户操作手册.html)
  * MIS系统环境临时记录 
    * [ MIS系统环境临时记录 ](../MIS系统环境临时记录/组态和大屏连接地址配置.html)
  *   * [ Published with GitBook ](https://www.gitbook.com)

#  __[三、单元测试](..)

## 三、单元测试

  1. 【强制】好的单元测试必须遵守AIR原则。   
说明：单元测试在线上运行时，感觉像空气（AIR）一样并不存在，但在测试质量的保障上，却是非常关键的。好的单元测试宏观上来说，具有自动化、独立性、可重复执行的特点。

    * A：Automatic（自动化）
    * I：Independent（独立性）
    * R：Repeatable（可重复）
  2. 【强制】单元测试应该是全自动执行的，并且非交互式的。测试用例通常是被定期执行的，执行过程必须完全自动化才有意义。输出结果需要人工检查的测试不是一个好的单元测试。单元测试中不准使用System.out来进行人肉验证，必须使用assert来验证。
  3. 【强制】保持单元测试的独立性。为了保证单元测试稳定可靠且便于维护，单元测试用例之间决不能互相调用，也不能依赖执行的先后次序。   
反例：method2需要依赖method1的执行，将执行结果作为method2的输入。

  4. 【强制】单元测试是可以重复执行的，不能受到外界环境的影响。   
说明：单元测试通常会被放到持续集成中，每次有代码check
in时单元测试都会被执行。如果单测对外部环境（网络、服务、中间件等）有依赖，容易导致持续集成机制的不可用。  
正例：为了不受外界环境影响，要求设计代码时就把SUT的依赖改成注入，在测试时用spring 这样的DI框架注入一个本地（内存）实现或者Mock实现。

  5. 【强制】对于单元测试，要保证测试粒度足够小，有助于精确定位问题。单测粒度至多是类级别，一般是方法级别。   
说明：只有测试粒度小才能在出错时尽快定位到出错位置。单测不负责检查跨类或者跨系统的交互逻辑，那是集成测试的领域。

  6. 【强制】核心业务、核心应用、核心模块的增量代码确保单元测试通过。   
说明：新增代码及时补充单元测试，如果新增代码影响了原有单元测试，请及时修正。

  7. 【强制】单元测试代码必须写在如下工程目录：src/test/java，不允许写在业务代码目录下。   
说明：源码构建时会跳过此目录，而单元测试框架默认是扫描此目录。

  8. 【推荐】单元测试的基本目标：语句覆盖率达到70%；核心模块的语句覆盖率和分支覆盖率都要达到100%   
说明：在工程规约的应用分层中提到的DAO层，Manager层，可重用度高的Service，都应该进行单元测试。

  9. 【推荐】编写单元测试代码遵守BCDE原则，以保证被测试模块的交付质量。
    * B：Border，边界值测试，包括循环边界、特殊取值、特殊时间点、数据顺序等。
    * C：Correct，正确的输入，并得到预期的结果。
    * D：Design，与设计文档相结合，来编写单元测试。
    * E：Error，强制错误信息输入（如：非法数据、异常流程、非业务允许输入等），并得到预期的结果。
  10. 【推荐】对于数据库相关的查询，更新，删除等操作，不能假设数据库里的数据是存在的，或者直接操作数据库把数据插入进去，请使用程序插入或者导入数据的方式来准备数据。   
反例：删除某一行数据的单元测试，在数据库中，先直接手动增加一行作为删除目标，但是这一行新增数据并不符合业务插入规则，导致测试结果异常。

  11. 【推荐】和数据库相关的单元测试，可以设定自动回滚机制，不给数据库造成脏数据。或者对单元测试产生的数据有明确的前后缀标识。   
正例：在RDC内部单元测试中，使用RDC _UNIT_TEST_ 的前缀标识数据。

  12. 【推荐】对于不可测的代码建议做必要的重构，使代码变得可测，避免为了达到测试要求而书写不规范测试代码。
  13. 【推荐】在设计评审阶段，开发人员需要和测试人员一起确定单元测试范围，单元测试最好覆盖所有测试用例（UC）。
  14. 【推荐】单元测试作为一种质量保障手段，不建议项目发布后补充单元测试用例，建议在项目提测前完成单元测试。
  15. 【参考】为了更方便地进行单元测试，业务代码应避免以下情况：
    * 构造方法中做的事情过多。
    * 存在过多的全局变量和静态方法。
    * 存在过多的外部依赖。
    * 存在过多的条件语句。   
说明：多层条件语句建议使用卫语句、策略模式、状态模式等方式重构。

  16. 【参考】不要对单元测试存在如下误解：
    * 那是测试同学干的事情。本文是开发手册，凡是本文内容都是与开发同学强相关的。
    * 单元测试代码是多余的。汽车的整体功能与各单元部件的测试正常与否是强相关的。
    * 单元测试代码不需要维护。一年半载后，那么单元测试几乎处于废弃状态。
    * 单元测试与线上故障没有辩证关系。好的单元测试能够最大限度地规避线上故障。

#  results matching ""

# No results matching ""

[ __](异常日志/其他.html) [ __](安全规约.html)

